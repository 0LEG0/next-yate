<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [Yate][1]
    *   [Parameters][2]
    *   [Examples][3]
    *   [acknowledge][4]
        *   [Parameters][5]
    *   [dispatch][6]
        *   [Parameters][7]
        *   [Examples][8]
    *   [enqueue][9]
        *   [Parameters][10]
        *   [Examples][11]
    *   [getConsole][12]
        *   [Examples][13]
    *   [getEnvironment][14]
        *   [Examples][15]
    *   [handlers][16]
        *   [Parameters][17]
    *   [init][18]
        *   [Parameters][19]
        *   [Examples][20]
    *   [install][21]
        *   [Parameters][22]
        *   [Examples][23]
    *   [output][24]
        *   [Parameters][25]
    *   [setlocal][26]
        *   [Parameters][27]
        *   [Examples][28]
    *   [toChannel][29]
        *   [Examples][30]
    *   [uninstall][31]
        *   [Parameters][32]
        *   [Examples][33]
    *   [unwatch][34]
        *   [Parameters][35]
        *   [Examples][36]
    *   [watch][37]
        *   [Parameters][38]
        *   [Examples][39]
*   [YateChannel][40]
    *   [Parameters][41]
    *   [Examples][42]
    *   [answered][43]
        *   [Parameters][44]
    *   [callJust][45]
        *   [Parameters][46]
    *   [callTo][47]
        *   [Parameters][48]
    *   [hangup][49]
        *   [Parameters][50]
    *   [init][51]
        *   [Parameters][52]
    *   [install][53]
        *   [Parameters][54]
    *   [progress][55]
        *   [Parameters][56]
    *   [reset][57]
        *   [Parameters][58]
    *   [ringing][59]
        *   [Parameters][60]
    *   [watch][61]
        *   [Parameters][62]
*   [YateMessage][63]
    *   [Parameters][64]
    *   [Examples][65]
    *   [copyParams][66]
        *   [Parameters][67]
    *   [getParam][68]
        *   [Parameters][69]
    *   [msgTime][70]
    *   [retValue][71]
        *   [Parameters][72]
    *   [setParam][73]
        *   [Parameters][74]

##

*   **See**: [https://github.com/0LEG0/next-yate][75]

Next-Yate is Nodejs External module for YATE (Yet Another Telephony Engine).

**Meta**

*   **version**: 0.1.0
*   **author**: Anton \<aucyxob@gmail.com>
*   **license**: Apache-2.0

## Yate

**Extends EventEmitter**

*   **See**: Yate#init
*   **See**: Yate#toChannel
*   **See**: [https://docs.yate.ro/wiki/External_module_command_flow][76]

Yate object provides connection to Yate's external module.

### Parameters

*   `options` **[Object][77]** (optional)

    *   `options.host` **[string][78]** address of listerning Yate's extmodule for ex. "127.0.0.1", default "undefined", stdin/stdout connected
    *   `options.port` **[number][79]** port default 5040
    *   `options.path` **[string][78]** socket path, default "undefined"
    *   `options.trackname` **[string][78]** track name of connected script, default "next-yate"
    *   `options.reconnect` **[boolean][80]** reconnect on collisions, default true
    *   `options.reconnnect_timeout` **[number][79]** reconnect tries interval in milliseconds, default 10000
    *   `options.dispatch_timeout` **[number][79]** auto drop the response waiting in Yate.dispatch method after the timeout in milliseconds if Engine not respond, default 10000
    *   `options.acknowledge_timeout` **[number][79]** auto reply to incoming message as is if the callback function did not responded in the timeout, so as not to overload the Engine queue and not cause the engine to crash. default 10000
    *   `options.bufsize` **[number][79]** sets the maximum size of transferred data in extmodule, oversize will be truncated to the specified value, default 8192.
    *   `options.channel` **[boolean][80]** to run the Application in channel mode ^NNN=extmodule/nodata/node.sh example.js

### Examples

```javascript
const {Yate} = require("next-yate");
let yate = new Yate({host: "127.0.0.1", trackname: "myscript"});
yate.init();
yate.output("Hello World!");
```

### acknowledge

Acknowledges the message.
Not needed in common cases because of all incoming messages acknowledges automatically

#### Parameters

*   `msg`  
*   `message` **[YateMessage][81]** 

Returns **[Promise][82]** resolve(YateMessage) or reject(Error)

### dispatch

*   **See**: Yate#enqueue

Dispatches the Message in the Yate engine.

#### Parameters

*   `msg`  
*   `message` **[YateMessage][81]** (required)

#### Examples

```javascript
const {Yate, YateMessage} = require("next-yate");
let yate = new Yate();
yate.init();
let m = new YateMessage("call.route", false, { id: "test/1", caller: "123", called: "321" });
yate.dispatch(m)
    .then(res => {console.log("Successfully dispatched\n", res.retValue())},
          err => {console.log("Dispatch error\n", err)} );
```

Returns **[Promise][82]** reolve(YateMessage) where YateMessage is handled message, reject(Error) on error

### enqueue

*   **See**: Yate#dispatch

Enqueues the Message in the Yate engine

#### Parameters

*   `msg`  
*   `message` **[YateMessage][81]** (required)

#### Examples

```javascript
const {Yate, YateMessage} = require("next-yate");
let yate = new Yate();
yate.init();
let m = new YateMessage("call.drop", false, { id: "sip/123" });
yate.equeue(m);
```

Returns **[Promise][82]** resolve(YateMessage) with unhandled message or reject(Error) on error

### getConsole

Returns Console connected to Yate's output

#### Examples

```javascript
yate.getConsole().log("Find this message in yate's output");
```

Returns **[Console][83]** 

### getEnvironment

Returns set of connection's specific parameners

#### Examples

```javascript
{
  version: '6.1.1',
  release: 'devel1',
  nodename: 'svn',
  runid: '1580736088',
  configname: 'yate',
  sharedpath: './share',
  configpath: './conf.d',
  cfgsuffix: '.conf',
  modulepath: './modules',
  modsuffix: '.yate',
  logfile: '',
  clientmode: 'false',
  supervised: 'false',
  maxworkers: '10'
};
```

Returns **[Promise][82]** resolve(Object) where Object is set of connection's specific parameners

### handlers

handlers() returns array of message handlers \[{name, priority, handler, filterName, filterValue}]

#### Parameters

*   `filter` **([string][78] | [RegExp][84])** 

Returns **[Array][85]** Array of message handlers

### init

*   **See**: Yate#toChannel

Init the Yate instance.
Connects it to Extmodule, makes readable and writable inbound and outbound streams.

#### Parameters

*   `callback` **[function][86]** callback will executed after successful connect

#### Examples

```javascript
let yate = new Yate();
yate.init(() => { console.log("Connnected") });
```

Returns **[Promise][82]** resolve(true) if done or false if failed.

### install

*   **See**: YateMessage
*   **See**: [https://docs.yate.ro/wiki/Standard_Messages][87]

Sets the handler to a specific message.

#### Parameters

*   `handler` **[function][86]** message handler (required)
*   `name` **[string][78]** message name (required)
*   `prio` **[number][79]** priority of the handler on Yate's side, as low value as high proirity (optional, default value 100)
*   `filter` **[string][78]** filter is name of message parameter (optional, for example "called")
*   `fvalue` **[string][78]** filter is value of message parameter (optional, for example "^9999.\*")

#### Examples

```javascript
const {Yate, YateMessage} = require("next-yate");

function onRoute(message) {
    message.retValue("tone/ring"); // send the incoming call to tone/ring module
}

let yate = new Yate();
yate.init();
yate.install(onRoute, "call.route", 90, "called", "^9999.*");
```

Returns **[Promise][82]** resolve(true) on successfully installed handler, resolve(false) on fail, reject(Error) on error

### output

Output data to Yate log.

#### Parameters

*   `args` **...any** 
*   `line` **[string][78]** 

### setlocal

*   **See**: [https://docs.yate.ro/wiki/External_module_command_flow][76]

Set/change/read connection parameters.

#### Parameters

*   `name` **[string][78]** parameter name (required)
*   `value` **[string][78]** parameter value (optional, if undefined the method returns the parameter value)

#### Examples

```javascript
const {Yate, YateMessage} = require("next-yate");
let yate = new Yate();
yate.init();
let ver = await yate.setlocal("engine.version");
console.log(ver);
```

Returns **[Promise][82]** resolve(value or success)

### toChannel

*   **See**: Yate#init
*   **See**: YateChannel

Alternative initialization of Yate in channel mode with the special Channel object.
New instance of Yate --> Yate.toChannel --> Channel.init --> callback

#### Examples

```javascript
regexroute.conf:
^NNN=extmodule/nodata/node.sh example.js

example.js:
const {Yate} = require("next-yate");
const yate = new Yate();
const Channel = yate.toChannel();
Channel.init(main, {autoanswer: true});

function main(message) {
    if (message.called=="32843")
        Channel.callJust("wave/play/./share/sounds/welcome.au");
}
```

Returns **[YateChannel][88]** 

### uninstall

*   **See**: Yate#install

Removes the handler from a specific message

#### Parameters

*   `args` **...any** 
*   `name` **[string][78]** message name (required)

#### Examples

```javascript
yate.uninstall("call.route");
```

Returns **[Promise][82]** resolve(true) if message handler removed from Yate's side, resolve(false) if no, reject(Error) on error.

### unwatch

*   **See**: Yate#watch

Removes the watch handler from a specific yate message.

#### Parameters

*   `args` **...any** 
*   `name` **[string][78]** message name (required)

#### Examples

```javascript
yate.unwatch("engine.timer");
```

Returns **[Promise][82]** resolve(true) if message handler removed from Yate's side, resolve(false) if no, reject(Error) on error.

### watch

*   **See**: [https://docs.yate.ro/wiki/Standard_Messages][87]
*   **See**: Yate#install

Sets the handler to a specific yate message.
In contrast to the method of Yate.install it does not require an answer to message. You will get already handled messages.

#### Parameters

*   `handler` **[function][86]** function to be message handler (required)
*   `name` **[string][78]** message name (required)
*   `filterName`  
*   `filterValue`  

#### Examples

```javascript
const {Yate, YateMessage} = require("next-yate");

function onTimer(message) {
    concole.log(message.time);
}

let yate = new Yate();
yate.init();
yate.watch(onTimer, "engine.timer");
```

Returns **[Promise][82]** resolve(true) on successfully installed handler, resolve(false) on fail, reject(Error) on error.

## YateChannel

**Extends EventEmitter**

YateChannel is an abstraction over incoming call leg.
It simplifyes most typical operations with call like attach media, answer/hangup, redirect and etc.

### Parameters

*   `message` **[YateMessage][81]** Only "call.route" or "call.execute" are supported (required)

### Examples

```javascript
let chan = new YateChannel(incoming_message);
chan.init()
    .then(m => console.log("Channel", m.id, "initialized"))
    .then(() => chan.callTo("wave/play/./prompt.au"))
    .then(m => console.log("Channel", m.id, "prompted"))
    .then(() => chan.callJust("sip/sip:123@10.0.0.2"))
    .then(m => console.log("Channel", m.id, "redirected"));
```

### answered

*   **See**: [http://docs.yate.ro/wiki/Call.answered][89]

answered() is an abstraction over call.answered message.

#### Parameters

*   `params` **[Object][77]** parameters of call.answered message (optional)

Returns **[Promise][82]** resolve(false) if channel is not ready or has not been initialized, resolve(YateMessage) with "call.answered"

### callJust

*   **See**: [http://docs.yate.ro/wiki/Call.execute][90]

callJust() is an abstraction over call.execute message.

#### Parameters

*   `dst` **[string][78]** callto destination for call.execute message i.e. "sip/sip:[xxx@1.2.3.4][91]"
*   `params` **[Object][77]** parameters for call.execute message (optional)

Returns **[Promise][82]** resolve(false) if channel is not ready or has not been initialized, resolve(YateMessage) with handled "call.execute"

### callTo

*   **See**: [http://docs.yate.ro/wiki/Chan.attach][92]

callTo() is an abstraction over chan.attach message.

#### Parameters

*   `dst` **[string][78]** is source for "wave/play/", consumer for "wave/record/" or override for "tone/" (required)
*   `params` **[Object][77]** parameters of chan.attach message (optional) (optional, default `{}`)

Returns **[Promise][82]** resolve(false) if channel is not ready or has not been initialized, resolve(YateMessage) with last message on complete

### hangup

*   **See**: [http://docs.yate.ro/wiki/Call.drop][93]

hangup() is an abstraction over call.drop message.

#### Parameters

*   `reason` **[string][78]** reason parameter of call.drop message (optional)

Returns **[Promise][82]** resolve(YateMessage) with "call.drop" message

### init

init() - initialize YateChannel before use.
This method waits until the "call.execute" message arrives.

#### Parameters

*   `callback` **[function][86]** (optional)

Returns **[Promise][82]** resolve(YateMessage), resolve(false) if timeout

### install

*   **See**: Yate#install

install() - to set the "install" handler for the channel.

#### Parameters

*   `handler` **[function][86]** (required)
*   `name` **[string][78]** (required)
*   `priority` **[number][79]** default value is 80 (optional) (optional, default `80`)

Returns **[Promise][82]** 

### progress

*   **See**: [http://docs.yate.ro/wiki/Call.progress][94]

progress() is an abstraction over call.progress message.

#### Parameters

*   `params` **[Object][77]** parameters of call.progress message (optional)

Returns **[Promise][82]** resolve(false) if channel is not ready or has not been initialized, resolve(YateMessage) with "call.progress"

### reset

reset() - rejects active promise of channel.
It's useful if you need to break the chain of promises

#### Parameters

*   `message` **any** (optional)

Returns **[undefined][95]** 

### ringing

*   **See**: [http://docs.yate.ro/wiki/Call.ringing][96]

ringing() is an abstraction over call.ringing message.

#### Parameters

*   `params` **[Object][77]** parameters of call.ringing message (optional)

Returns **[Promise][82]** resolve(false) if channel is not ready or has not been initialized, resolve(YateMessage) with "call.ringing"

### watch

*   **See**: Yate#watch

watch() - to set the "watch" handler for the channel: filterName = "id", filterValue = channel.id.
Calling this method multiple times will overwrite the previous event handler. All event subscriptions will be automatically deleted after the call/channel hangup.

#### Parameters

*   `handler` **[function][86]** (required)
*   `name` **[string][78]** (required)

Returns **[Promise][82]** 

## YateMessage

*   **See**: Yate

YateMessage is object Yate can interact with.
YateMessage can be of two types:<ul>

<li>"incoming" - message generated by Engine to Application and can be handled using a callback in the Yate.install or Yate.watch methods</li>
<li>"outgoing" - new Message generated by Application and sent to Engine using the Yate.dispatch or Yate.enqueue methods</li>
</ul>

### Parameters

*   `name` **[string][78]** message name (required)
*   `broadcast` **[boolean][80]** (not used)
*   `params` **[Object][77]** message parameters (optional)

### Examples

```javascript
const {Yate, YateMessage} = require("next-yate");
let yate = new Yate();
yate.init();
let m = new YateMessage("call.drop", { id: "sip/123", reason: "timeout" });
yate.enqueue(m);
```

### copyParams

#### Parameters

*   `obj` **[Object][77]** object from which to copy properties (required)
*   `prefix` **[string][78]** parameters begins with prefix (optional)
*   `skip` **[string][78]** will be ignored (optional)

### getParam

#### Parameters

*   `name` **[string][78]** name of the parameter to retrieve (requred)
*   `defValue` **any** value to return if parameter is missing (optional)
*   `autoNumber` **[boolean][80]** automatically convert parameters to boolean or number type, default true (optional)

Returns **any** value of parameter

### msgTime

Returns **[number][79]** Message creation time in milliseconds since EPOCH

### retValue

#### Parameters

*   `value` **[string][78]** new returned value to set in the message, if undefined method returns "Returned value of the message" (optional)

Returns **[string][78]** returned value of the message

### setParam

#### Parameters

*   `name` **[string][78]** name of the parameter to set (required)
*   `value` **any** new value to set in parameter, undefined to delete the parameter

Returns **[boolean][80]** true on success, false if message was not in a state where parameters can be changed

[1]: #yate

[2]: #parameters

[3]: #examples

[4]: #acknowledge

[5]: #parameters-1

[6]: #dispatch

[7]: #parameters-2

[8]: #examples-1

[9]: #enqueue

[10]: #parameters-3

[11]: #examples-2

[12]: #getconsole

[13]: #examples-3

[14]: #getenvironment

[15]: #examples-4

[16]: #handlers

[17]: #parameters-4

[18]: #init

[19]: #parameters-5

[20]: #examples-5

[21]: #install

[22]: #parameters-6

[23]: #examples-6

[24]: #output

[25]: #parameters-7

[26]: #setlocal

[27]: #parameters-8

[28]: #examples-7

[29]: #tochannel

[30]: #examples-8

[31]: #uninstall

[32]: #parameters-9

[33]: #examples-9

[34]: #unwatch

[35]: #parameters-10

[36]: #examples-10

[37]: #watch

[38]: #parameters-11

[39]: #examples-11

[40]: #yatechannel

[41]: #parameters-12

[42]: #examples-12

[43]: #answered

[44]: #parameters-13

[45]: #calljust

[46]: #parameters-14

[47]: #callto

[48]: #parameters-15

[49]: #hangup

[50]: #parameters-16

[51]: #init-1

[52]: #parameters-17

[53]: #install-1

[54]: #parameters-18

[55]: #progress

[56]: #parameters-19

[57]: #reset

[58]: #parameters-20

[59]: #ringing

[60]: #parameters-21

[61]: #watch-1

[62]: #parameters-22

[63]: #yatemessage

[64]: #parameters-23

[65]: #examples-13

[66]: #copyparams

[67]: #parameters-24

[68]: #getparam

[69]: #parameters-25

[70]: #msgtime

[71]: #retvalue

[72]: #parameters-26

[73]: #setparam

[74]: #parameters-27

[75]: https://github.com/0LEG0/next-yate

[76]: https://docs.yate.ro/wiki/External_module_command_flow

[77]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[78]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[79]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[80]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[81]: #yatemessage

[82]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[83]: https://developer.mozilla.org/docs/Web/API/Console

[84]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RegExp

[85]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[86]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[87]: https://docs.yate.ro/wiki/Standard_Messages

[88]: #yatechannel

[89]: http://docs.yate.ro/wiki/Call.answered

[90]: http://docs.yate.ro/wiki/Call.execute

[91]: mailto:xxx@1.2.3.4

[92]: http://docs.yate.ro/wiki/Chan.attach

[93]: http://docs.yate.ro/wiki/Call.drop

[94]: http://docs.yate.ro/wiki/Call.progress

[95]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined

[96]: http://docs.yate.ro/wiki/Call.ringing
